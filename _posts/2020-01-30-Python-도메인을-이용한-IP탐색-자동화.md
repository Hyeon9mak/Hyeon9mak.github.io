---
title: "[Python 미니 프로젝트] 도메인을 이용한 IP탐색 자동화"
date: 2020-01-30 17:49:00
categories:
    - Python
tags:
    - Python
    - 파이썬
    - 도메인
    - domain
    - IP
    - nslookup
    - cmd
toc: true
toc_sticky: true
toc_label: "도메인을 이용한 IP탐색 자동화"
---

도메인에 매핑되어 있는 IP들을 cmd 명령어 nslookup을 통해 하나하나 확인 후 기록해달라는 요청을 받았다.

![photo1](https://user-images.githubusercontent.com/37354145/73727129-3fc6e800-4774-11ea-8c8c-32d9a48243a9.PNG){: .align-center}
  
처음 엑셀 파일을 열어보고 당황했지만, 갯수나 세어보고 얼마 안되면 해치워버리자는 마음으로 갯수를 세보았다.  
그랬더니 100개가 넘어가네..
  
![photo2](https://app.jjalbang.today/jjNS.jpg){: .align-center}
  
물론 시간을 들인다면 해낼 수 있겠지만, 3가지 특이점이 왔었다.
1. 도저히 그럴 엄두가 안난다.
2. 100회가 넘어가는 반복 동작이면 분명 실수가 발생할 것이다.
3. 발생한 실수를 찾아낼 자신이 없다.
4. 단순 동작이 반복된다.
  
이 때 4번이 나한테 희망을 주고 있었는데, 얼마전부터 계속 진행하던 [[Python 재무제표 크롤링 #1]](https://hyeon9mak.github.io/python/Python-%EC%9E%AC%EB%AC%B4%EC%A0%9C%ED%91%9C-%EC%9B%B9-%ED%81%AC%EB%A1%A4%EB%A7%81-1/) 덕분에 쌓였던 '파이썬으로는 무엇이든 할 수 있다!' 라는 기대감이 4번과 증폭되어서, 
'파이썬으로 자동화를 시켜보자!' 라는 생각에 이르렀다.
  
## 설계 준비
당장 나에게 필요한 정보가 두 가지였다.
- 파이썬을 이용해서 cmd 프로그램에 명령어를 입력할 수 있는가?
- 파이썬을 이용해서 cmd 프로그램의 출력 내용을 가져올 수 있는가?
  
다행스럽게도, **os** 모듈을 이용하면 cmd 프로그램에 입/출력이 가능하다는 것을 확인할 수 있었다.  
기쁜 마음으로 구현을 시작하려는 찰나, 한 가지 더 필요한 정보가 떠올랐다.
- nslookup은 대화형 명령어인데, 비대화형으로 사용할 수 있는가?
  
생각치도 못한 문제였다. 


```python
import os
import subprocess
import pandas as pd

domain_list = []
domain_list.append("domain0.com")
domain_list.append("domain1.co.kr")               # 실제 이용해보실 때는 도메인 주소를 일렬로 복사 붙여넣기 하신 후
domain_list.append("domain2.co.in")            # Ctrl+Alt+(방향키 위 또는 아래) 로 다중 커서를 적용 하시고
domain_list.append("domain3.co.in")              # domain_list.append(" 까지 입력,
domain_list.append("domain4.in")                 # 다중 커서 상태로 End 키를 눌러 모든 행의 맨 끝으로 이동 
domain_list.append("domain5.co.in")               # ") 를 작성하시면 왼쪽과 같은 형태를 금방 채울 수 있습니다.
domain_list.append("domain6.in")
domain_list.append("domain7.co.kr")          
domain_list.append("domain8.com")
domain_list.append("domain9.co.kr")



f = open('test.txt','w')                        # cmd 결과를 저장 할 txt파일 생성 및 쓰기 형식으로 열기
for domain in domain_list :                     # 전체 도메인 반복
    command = "nslookup " + domain              # "nslookup something.co.kr"
    
    sysMsg = subprocess.getstatusoutput(command)    # cmd에 명령어 입력 후, 결과 가져오기
    f.write(sysMsg[1])                          # 가져온 결과물 파일에 적기
f.close()                                       # txt파일 닫기

r = open('test.txt', 'r')                       # 닫았던 txt파일 읽기 형식으로 열기
t = pd.DataFrame(columns=['domain', 'Address']) # column이 domain / Address 인 Dataframe 생성
t_count = 0                                     # Dataframe 행 카운터
read_line = "A"                                 # while 반복문 조건을 위해 선언한 문자열

while read_line :                               # readline 결과가 NULL이라면 (EOF) 탈출
    READ_LIST = []                              # 빈 list 선언
    read_line = r.readline()                    # 줄 단위 읽어오기

    if '이름' in read_line :                    # 읽어온 줄에 '이름' 이 포함되어 있다면 (IP가 확인된다면)
        read_line = read_line.split()           # 공백 기준 나누기
        read_underline = r.readline()           # 바로 아래줄 추가로 읽어오기
        read_underline = read_underline.split() # 추가로 읽어온 아래줄 공백 기준 나누기
        READ_LIST.append(read_line[1])          # 두 줄 모두 비어있던 list에 추가
        READ_LIST.append(read_underline[1])
        
        t.loc[t_count] = READ_LIST              # list를 DataFrame에 추가
        t_count += 1                            # Dataframe 행 카운터++
    
    if '***' in read_line :                     # 읽어온 줄에 '***' 이 포함되어 있다면 (IP가 확인되지 않는다면)
        read_line = read_line.split()           # 공백 기준 나누기
        read_line[2] = read_line[2].replace("을(를)", "") # 을(를) 지우기
        READ_LIST.append(read_line[2])          # list에 domain명 추가하고, IP 컬럼에는 N/A
        READ_LIST.append("N/A")
        t.loc[t_count] = READ_LIST              # list를 Dataframe에 추가
        t_count += 1                            # Dataframe 행 카운터++

r.close()                                       # 다 읽은 파일 닫기
t.to_csv('C:\\Users\\admin\\Desktop\\test1.csv', encoding='cp949', index=False, mode='w')   # Dataframe 엑셀로 저장
```